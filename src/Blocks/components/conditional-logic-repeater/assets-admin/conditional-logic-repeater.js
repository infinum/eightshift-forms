/**
 * Custom component was used from this repo.
 *
 * @link https://github.com/goranalkovic-infinum/conditional-logic-repeater
 *
 * @author Goran AlkoviÄ‡
 */

export class ConditionalTags {
	constructor(options) {
		this.fieldSelector = options.fieldSelector;
	}

	init = () => {
		const elements = document.querySelectorAll(this.fieldSelector);

		// Loop all forms on the page.
		[...elements].forEach((element) => {

			const id = element.getAttribute('data-id');
			const autoclear = element.getAttribute('autoclear');
			const input = document.querySelector(`#${id}`);

			element.addEventListener('es-conditional-logic-repeater-update', (event) => {
				const {
					enabled,
					behavior,
					logic,
					conditions
				} = event.detail;

				const data = [
					behavior,
					logic,
					conditions.map((item) => {
						return [
							item.field,
							item.comparison,
							item.value,
						]
					})
				];

				if (!enabled && autoclear) {
					input.value = '';
				} else {
					input.value = JSON.stringify(data);
				}
			});
		});
	}
}

export function conditionalLogicRepeaterComponent() {
	(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();function J(){}function Z(t){return t()}function $(){return Object.create(null)}function R(t){t.forEach(Z)}function ae(t){return typeof t=="function"}function me(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function be(t){return Object.keys(t).length===0}function _(t,e){t.appendChild(e)}function j(t,e,n){t.insertBefore(e,n||null)}function z(t){t.parentNode.removeChild(t)}function m(t){return document.createElement(t)}function F(t){return document.createTextNode(t)}function P(){return F(" ")}function ue(){return F("")}function H(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function E(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function ve(t){return Array.from(t.childNodes)}function ee(t,e){t.value=e==null?"":e}function B(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e){o.selected=!0;return}}t.selectedIndex=-1}function K(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function ke(t){const e={};for(const n of t)e[n.name]=n.value;return e}let x;function U(t){x=t}const I=[],X=[],G=[],te=[],ye=Promise.resolve();let Y=!1;function we(){Y||(Y=!0,ye.then(T))}function V(t){G.push(t)}const Q=new Set;let D=0;function T(){const t=x;do{for(;D<I.length;){const e=I[D];D++,U(e),Ce(e.$$)}for(U(null),I.length=0,D=0;X.length;)X.pop()();for(let e=0;e<G.length;e+=1){const n=G[e];Q.has(n)||(Q.add(n),n())}G.length=0}while(I.length);for(;te.length;)te.pop()();Y=!1,Q.clear(),U(t)}function Ce(t){if(t.fragment!==null){t.update(),R(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(V)}}const Ee=new Set;function fe(t,e){t&&t.i&&(Ee.delete(t),t.i(e))}function de(t,e){t.d(1),e.delete(t.key)}function he(t,e,n,o,r,i,l,c,s,f,v,d){let g=t.length,k=i.length,h=g;const A={};for(;h--;)A[t[h].key]=h;const C=[],O=new Map,u=new Map;for(h=k;h--;){const b=d(r,i,h),L=n(b);let N=l.get(L);N?o&&N.p(b,e):(N=f(L,b),N.c()),O.set(L,C[h]=N),L in A&&u.set(L,Math.abs(h-A[L]))}const p=new Set,S=new Set;function w(b){fe(b,1),b.m(c,v),l.set(b.key,b),v=b.first,k--}for(;g&&k;){const b=C[k-1],L=t[g-1],N=b.key,y=L.key;b===L?(v=b.first,g--,k--):O.has(y)?!l.has(N)||p.has(N)?w(b):S.has(y)?g--:u.get(N)>u.get(y)?(S.add(N),w(b)):(p.add(y),g--):(s(L,l),g--)}for(;g--;){const b=t[g];O.has(b.key)||s(b,l)}for(;k;)w(C[k-1]);return C}function Me(t,e,n,o){const{fragment:r,on_mount:i,on_destroy:l,after_update:c}=t.$$;r&&r.m(e,n),o||V(()=>{const s=i.map(Z).filter(ae);l?l.push(...s):R(s),t.$$.on_mount=[]}),c.forEach(V)}function Le(t,e){const n=t.$$;n.fragment!==null&&(R(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Se(t,e){t.$$.dirty[0]===-1&&(I.push(t),we(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ne(t,e,n,o,r,i,l,c=[-1]){const s=x;U(t);const f=t.$$={fragment:null,ctx:null,props:i,update:J,not_equal:r,bound:$(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(s?s.$$.context:[])),callbacks:$(),dirty:c,skip_bound:!1,root:e.target||s.$$.root};l&&l(f.root);let v=!1;if(f.ctx=n?n(t,e.props||{},(d,g,...k)=>{const h=k.length?k[0]:g;return f.ctx&&r(f.ctx[d],f.ctx[d]=h)&&(!f.skip_bound&&f.bound[d]&&f.bound[d](h),v&&Se(t,d)),g}):[],f.update(),v=!0,R(f.before_update),f.fragment=o?o(f.ctx):!1,e.target){if(e.hydrate){const d=ve(e.target);f.fragment&&f.fragment.l(d),d.forEach(z)}else f.fragment&&f.fragment.c();e.intro&&fe(t.$$.fragment),Me(t,e.target,e.anchor,e.customElement),T()}U(s)}let _e;typeof HTMLElement=="function"&&(_e=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(Z).filter(ae);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){R(this.$$.on_disconnect)}$destroy(){Le(this,1),this.$destroy=J}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const o=n.indexOf(e);o!==-1&&n.splice(o,1)}}$set(t){this.$$set&&!be(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});function ne(t,e,n){const o=t.slice();return o[24]=e[n],o[25]=e,o[26]=n,o}function le(t,e,n){const o=t.slice();return o[27]=e[n],o[29]=n,o}function He(t){let e,n,o,r,i,l;return{c(){e=m("label"),n=m("input"),r=F(`
			Use conditional logic`),E(n,"type","checkbox"),E(n,"part",o="use-toggle-checkbox "+(t[0]?"use-toggle-checkbox-enabled":"")),E(e,"part","use-toggle-label")},m(c,s){j(c,e,s),_(e,n),n.checked=t[0],_(e,r),i||(l=[H(n,"change",t[15]),H(n,"change",t[11])],i=!0)},p(c,s){s&1&&o!==(o="use-toggle-checkbox "+(c[0]?"use-toggle-checkbox-enabled":""))&&E(n,"part",o),s&1&&(n.checked=c[0])},d(c){c&&z(e),i=!1,R(l)}}}function oe(t){let e,n,o,r,i,l,c,s,f,v,d=[],g=new Map,k,h,A,C=t[3];const O=u=>u[26];for(let u=0;u<C.length;u+=1){let p=ne(t,C,u),S=O(p);g.set(S,d[u]=se(S,p))}return{c(){e=m("div"),n=m("select"),o=m("option"),o.textContent="Show",r=m("option"),r.textContent="Hide",i=F(`
			this field if
			`),l=m("select"),c=m("option"),c.textContent="all",s=m("option"),s.textContent="any",f=F(`
			of the following match:`),v=P();for(let u=0;u<d.length;u+=1)d[u].c();k=ue(),o.__value="show",o.value=o.__value,r.__value="hide",r.value=r.__value,E(n,"part","header-behavior-select"),t[1]===void 0&&V(()=>t[16].call(n)),c.__value="and",c.value=c.__value,s.__value="or",s.value=s.__value,E(l,"part","header-logic-select"),t[2]===void 0&&V(()=>t[17].call(l)),E(e,"class","conditional-logic-repeater__item"),E(e,"part","header")},m(u,p){j(u,e,p),_(e,n),_(n,o),_(n,r),B(n,t[1]),_(e,i),_(e,l),_(l,c),_(l,s),B(l,t[2]),_(e,f),j(u,v,p);for(let S=0;S<d.length;S+=1)d[S].m(u,p);j(u,k,p),h||(A=[H(n,"change",t[16]),H(n,"change",t[10]),H(l,"change",t[17]),H(l,"change",t[10])],h=!0)},p(u,p){p&2&&B(n,u[1]),p&4&&B(l,u[2]),p&1944&&(C=u[3],d=he(d,p,O,1,u,C,g,k.parentNode,de,se,k,ne))},d(u){u&&z(e),u&&z(v);for(let p=0;p<d.length;p+=1)d[p].d(u);u&&z(k),h=!1,R(A)}}}function ie(t){let e=[],n=new Map,o,r=t[7];const i=l=>l[29];for(let l=0;l<r.length;l+=1){let c=le(t,r,l),s=i(c);n.set(s,e[l]=re(s,c))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();o=ue()},m(l,c){for(let s=0;s<e.length;s+=1)e[s].m(l,c);j(l,o,c)},p(l,c){c&128&&(r=l[7],e=he(e,c,i,1,l,r,n,o.parentNode,de,re,o,le))},d(l){for(let c=0;c<e.length;c+=1)e[c].d(l);l&&z(o)}}}function re(t,e){let n,o=e[27].label+"",r;return{key:t,first:null,c(){n=m("option"),r=F(o),n.__value=e[27].value,n.value=n.__value,this.first=n},m(i,l){j(i,n,l),_(n,r)},p(i,l){e=i},d(i){i&&z(n)}}}function ce(t){let e,n,o;function r(){return t[21](t[26])}return{c(){e=m("button"),e.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 10H19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>',E(e,"part","remove-condition-button")},m(i,l){j(i,e,l),n||(o=H(e,"click",r),n=!0)},p(i,l){t=i},d(i){i&&z(e),n=!1,o()}}}function se(t,e){var W;let n,o,r,i,l,c,s,f,v,d,g,k,h,A,C,O,u,p,S,w=((W=e[4])==null?void 0:W.length)>0&&ie(e);function b(){e[18].call(o,e[25],e[26])}function L(){e[19].call(i,e[25],e[26])}function N(){e[20].call(h,e[25],e[26])}let y=e[26]>0&&ce(e);return{key:t,first:null,c(){n=m("div"),o=m("select"),w&&w.c(),r=P(),i=m("select"),l=m("option"),l.textContent="is",c=m("option"),c.textContent="is not",s=m("option"),s.textContent="greater than",f=m("option"),f.textContent="less than",v=m("option"),v.textContent="contains",d=m("option"),d.textContent="starts with",g=m("option"),g.textContent="ends with",k=P(),h=m("input"),A=P(),C=m("button"),C.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 10H10M19 10H10M10 10V1M10 10V19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>',O=P(),y&&y.c(),u=P(),E(o,"part","item-field-select"),e[24].field===void 0&&V(b),l.__value="is",l.value=l.__value,c.__value="isnot",c.value=c.__value,s.__value="gt",s.value=s.__value,f.__value="lt",f.value=f.__value,v.__value="contains",v.value=v.__value,d.__value="startsWith",d.value=d.__value,g.__value="endsWith",g.value=g.__value,E(i,"part","item-comparison-select"),e[24].comparison===void 0&&V(L),E(h,"type","text"),E(h,"part","item-value-input"),E(C,"part","add-condition-button"),E(n,"class","conditional-logic-repeater__item"),E(n,"part","item"),this.first=n},m(a,M){j(a,n,M),_(n,o),w&&w.m(o,null),B(o,e[24].field),_(n,r),_(n,i),_(i,l),_(i,c),_(i,s),_(i,f),_(i,v),_(i,d),_(i,g),B(i,e[24].comparison),_(n,k),_(n,h),ee(h,e[24].value),_(n,A),_(n,C),_(n,O),y&&y.m(n,null),_(n,u),p||(S=[H(o,"change",b),H(o,"change",e[10]),H(i,"change",L),H(i,"change",e[10]),H(h,"input",N),H(h,"change",e[10]),H(C,"click",e[8])],p=!0)},p(a,M){var q;e=a,((q=e[4])==null?void 0:q.length)>0?w?w.p(e,M):(w=ie(e),w.c(),w.m(o,null)):w&&(w.d(1),w=null),M&136&&B(o,e[24].field),M&136&&B(i,e[24].comparison),M&136&&h.value!==e[24].value&&ee(h,e[24].value),e[26]>0?y?y.p(e,M):(y=ce(e),y.c(),y.m(n,u)):y&&(y.d(1),y=null)},d(a){a&&z(n),w&&w.d(),y&&y.d(),p=!1,R(S)}}}function Oe(t){let e,n,o=t[6]&&He(t),r=(t[0]||!t[6])&&oe(t);return{c(){e=m("div"),o&&o.c(),n=P(),r&&r.c(),this.c=J,E(e,"class","conditional-logic-repeater"),E(e,"part","container")},m(i,l){j(i,e,l),o&&o.m(e,null),_(e,n),r&&r.m(e,null),t[22](e)},p(i,[l]){i[6]&&o.p(i,l),i[0]||!i[6]?r?r.p(i,l):(r=oe(i),r.c(),r.m(e,null)):r&&(r.d(1),r=null)},i:J,o:J,d(i){i&&z(e),o&&o.d(),r&&r.d(),t[22](null)}}}function Ae(t,e,n){let{enabled:o=!0}=e,{behavior:r="show"}=e,{logic:i="and"}=e,{conditions:l=[{field:"",comparison:"is",value:""}]}=e,{fields:c}=e,{toggleable:s=null}=e,{value:f=null}=e,{autoclear:v=null}=e,d;const g=typeof s<"u"&&s!==null,k=g&&typeof v<"u"&&v!==null,h=(c==null?void 0:c.length)>0?JSON.parse(c):"",A=()=>{n(3,l=[...l,{field:"",comparison:"is",value:""}])},C=a=>{n(3,l=l.filter((M,q)=>q!==a)),O()},O=()=>{d.dispatchEvent(new CustomEvent("es-conditional-logic-repeater-update",{detail:{enabled:o,behavior:r,logic:i,conditions:l},composed:!0}))};if(typeof f<"u"&&f!==null){const a=JSON.parse(f),{enabled:M,behavior:q,logic:ge,conditions:pe}=a;o=M,r=q,i=ge,l=pe}const u=()=>{O(),k&&!o&&(n(3,l=[{field:"",comparison:"is",value:""}]),n(1,r="show"),n(2,i="and"))};function p(){o=this.checked,n(0,o)}function S(){r=K(this),n(1,r)}function w(){i=K(this),n(2,i)}function b(a,M){a[M].field=K(this),n(3,l),n(7,h)}function L(a,M){a[M].comparison=K(this),n(3,l),n(7,h)}function N(a,M){a[M].value=this.value,n(3,l),n(7,h)}const y=a=>C(a);function W(a){X[a?"unshift":"push"](()=>{d=a,n(5,d)})}return t.$$set=a=>{"enabled"in a&&n(0,o=a.enabled),"behavior"in a&&n(1,r=a.behavior),"logic"in a&&n(2,i=a.logic),"conditions"in a&&n(3,l=a.conditions),"fields"in a&&n(4,c=a.fields),"toggleable"in a&&n(12,s=a.toggleable),"value"in a&&n(13,f=a.value),"autoclear"in a&&n(14,v=a.autoclear)},[o,r,i,l,c,d,g,h,A,C,O,u,s,f,v,p,S,w,b,L,N,y,W]}class Te extends _e{constructor(e){super(),this.shadowRoot.innerHTML='<style>.conditional-logic-repeater{--rptr-font-family:system-ui, sans-serif;--rptr-accent-color:var(--es-conditional-logic-repeater-accent, #29a3a3);--rptr-input-border-color:var(--es-conditional-logic-repeater-input-border, #8f9c9c);--rptr-font-size:var(--es-conditional-logic-repeater-font-size, 0.9em);font-family:system-ui, sans-serif;font-size:var(--rptr-font-size);display:flex;flex-direction:column;gap:1rem}.conditional-logic-repeater,.conditional-logic-repeater *{box-sizing:border-box}button{padding:0.25rem;border:0;margin:0;width:1.75rem;height:1.75rem;background-color:transparent;color:var(--rptr-accent-color);border:1px solid var(--rptr-accent-color);border-radius:100rem;display:flex;align-items:center;justify-content:center;cursor:pointer}button svg{width:1rem;height:1rem}input[type="checkbox"]{width:1.25rem;height:1.25rem;accent-color:var(--rptr-accent-color)}input[type="text"],select{height:2.5rem;border-radius:0.25rem;border:1px solid var(--rptr-input-border-color);padding:0.5rem;outline-color:var(--es-conditional-logic-repeater-accent);accent-color:var(--es-conditional-logic-repeater-accent)}label,.conditional-logic-repeater__item{display:flex;align-items:center;line-height:1}label{gap:0.25rem}.conditional-logic-repeater__item{gap:0.75rem}</style>',Ne(this,{target:this.shadowRoot,props:ke(this.attributes),customElement:!0},Ae,Oe,me,{enabled:0,behavior:1,logic:2,conditions:3,fields:4,toggleable:12,value:13,autoclear:14},null),e&&(e.target&&j(e.target,this,e.anchor),e.props&&(this.$set(e.props),T()))}static get observedAttributes(){return["enabled","behavior","logic","conditions","fields","toggleable","value","autoclear"]}get enabled(){return this.$$.ctx[0]}set enabled(e){this.$$set({enabled:e}),T()}get behavior(){return this.$$.ctx[1]}set behavior(e){this.$$set({behavior:e}),T()}get logic(){return this.$$.ctx[2]}set logic(e){this.$$set({logic:e}),T()}get conditions(){return this.$$.ctx[3]}set conditions(e){this.$$set({conditions:e}),T()}get fields(){return this.$$.ctx[4]}set fields(e){this.$$set({fields:e}),T()}get toggleable(){return this.$$.ctx[12]}set toggleable(e){this.$$set({toggleable:e}),T()}get value(){return this.$$.ctx[13]}set value(e){this.$$set({value:e}),T()}get autoclear(){return this.$$.ctx[14]}set autoclear(e){this.$$set({autoclear:e}),T()}}customElements.define("conditional-logic-repeater",Te);
}
