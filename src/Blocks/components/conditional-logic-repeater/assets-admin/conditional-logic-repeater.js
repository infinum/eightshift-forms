/**
 * Custom component was used from this repo.
 *
 * @link https://github.com/goranalkovic-infinum/conditional-logic-repeater
 *
 * @author Goran AlkoviÄ‡
 */

export class ConditionalTags {
	constructor(options) {
		this.fieldSelector = options.fieldSelector;
	}

	init = () => {
		const elements = document.querySelectorAll(this.fieldSelector);

		// Loop all forms on the page.
		[...elements].forEach((element) => {

			const id = element.getAttribute('data-id');
			const input = document.querySelector(`#${id}`);

			element.addEventListener('es-conditional-logic-repeater-update', (event) => {
				const {
					enabled,
					behavior,
					logic,
					conditions,
				} = event.detail;

				if (conditions[0].field !== '') {
					const data = [
						behavior,
						logic,
						conditions.filter((item) => {
							if (item.field !== '') {
								return [
									item.field,
									item.comparison,
									item.value,
								];
							}
						})
					];

					input.value = JSON.stringify(data);
				}
			});
		});
	}
}

export function conditionalLogicRepeaterComponent() {
	(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();function W(){}function $(t){return t()}function ie(){return Object.create(null)}function R(t){t.forEach($)}function ge(t){return typeof t=="function"}function we(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Ce(t){return Object.keys(t).length===0}function _(t,e){t.appendChild(e)}function j(t,e,n){t.insertBefore(e,n||null)}function T(t){t.parentNode.removeChild(t)}function m(t){return document.createElement(t)}function F(t){return document.createTextNode(t)}function V(){return F(" ")}function pe(){return F("")}function N(t,e,n,l){return t.addEventListener(e,n,l),()=>t.removeEventListener(e,n,l)}function E(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ee(t){return Array.from(t.childNodes)}function re(t,e){t.value=e==null?"":e}function J(t,e){for(let n=0;n<t.options.length;n+=1){const l=t.options[n];if(l.__value===e){l.selected=!0;return}}t.selectedIndex=-1}function G(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function Me(t){const e={};for(const n of t)e[n.name]=n.value;return e}let ee;function K(t){ee=t}const U=[],Z=[],X=[],ce=[],Se=Promise.resolve();let x=!1;function Le(){x||(x=!0,Se.then(H))}function q(t){X.push(t)}const Y=new Set;let Q=0;function H(){const t=ee;do{for(;Q<U.length;){const e=U[Q];Q++,K(e),Ne(e.$$)}for(K(null),U.length=0,Q=0;Z.length;)Z.pop()();for(let e=0;e<X.length;e+=1){const n=X[e];Y.has(n)||(Y.add(n),n())}X.length=0}while(U.length);for(;ce.length;)ce.pop()();x=!1,Y.clear(),K(t)}function Ne(t){if(t.fragment!==null){t.update(),R(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(q)}}const Oe=new Set;function me(t,e){t&&t.i&&(Oe.delete(t),t.i(e))}function be(t,e){t.d(1),e.delete(t.key)}function ve(t,e,n,l,r,i,o,s,a,f,v,d){let g=t.length,y=i.length,h=g;const O={};for(;h--;)O[t[h].key]=h;const w=[],A=new Map,u=new Map;for(h=y;h--;){const b=d(r,i,h),M=n(b);let L=o.get(M);L?l&&L.p(b,e):(L=f(M,b),L.c()),A.set(M,w[h]=L),M in O&&u.set(M,Math.abs(h-O[M]))}const p=new Set,S=new Set;function C(b){me(b,1),b.m(s,v),o.set(b.key,b),v=b.first,y--}for(;g&&y;){const b=w[y-1],M=t[g-1],L=b.key,k=M.key;b===M?(v=b.first,g--,y--):A.has(k)?!o.has(L)||p.has(L)?C(b):S.has(k)?g--:u.get(L)>u.get(k)?(S.add(L),C(b)):(p.add(k),g--):(a(M,o),g--)}for(;g--;){const b=t[g];A.has(b.key)||a(b,o)}for(;y;)C(w[y-1]);return w}function Ae(t,e,n,l){const{fragment:r,on_mount:i,on_destroy:o,after_update:s}=t.$$;r&&r.m(e,n),l||q(()=>{const a=i.map($).filter(ge);o?o.push(...a):R(a),t.$$.on_mount=[]}),s.forEach(q)}function He(t,e){const n=t.$$;n.fragment!==null&&(R(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function je(t,e){t.$$.dirty[0]===-1&&(U.push(t),Le(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Te(t,e,n,l,r,i,o,s=[-1]){const a=ee;K(t);const f=t.$$={fragment:null,ctx:null,props:i,update:W,not_equal:r,bound:ie(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:ie(),dirty:s,skip_bound:!1,root:e.target||a.$$.root};o&&o(f.root);let v=!1;if(f.ctx=n?n(t,e.props||{},(d,g,...y)=>{const h=y.length?y[0]:g;return f.ctx&&r(f.ctx[d],f.ctx[d]=h)&&(!f.skip_bound&&f.bound[d]&&f.bound[d](h),v&&je(t,d)),g}):[],f.update(),v=!0,R(f.before_update),f.fragment=l?l(f.ctx):!1,e.target){if(e.hydrate){const d=Ee(e.target);f.fragment&&f.fragment.l(d),d.forEach(T)}else f.fragment&&f.fragment.c();e.intro&&me(t.$$.fragment),Ae(t,e.target,e.anchor,e.customElement),H()}K(a)}let ye;typeof HTMLElement=="function"&&(ye=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map($).filter(ge);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){R(this.$$.on_disconnect)}$destroy(){He(this,1),this.$destroy=W}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const l=n.indexOf(e);l!==-1&&n.splice(l,1)}}$set(t){this.$$set&&!Ce(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});function se(t,e,n){const l=t.slice();return l[26]=e[n],l[27]=e,l[28]=n,l}function ae(t,e,n){const l=t.slice();return l[29]=e[n],l[31]=n,l}function ze(t){let e,n,l,r,i,o;return{c(){e=m("label"),n=m("input"),r=F(`
			Use conditional logic`),E(n,"type","checkbox"),E(n,"part",l="use-toggle-checkbox "+(t[0]?"use-toggle-checkbox-enabled":"")),E(e,"part","use-toggle-label")},m(s,a){j(s,e,a),_(e,n),n.checked=t[0],_(e,r),i||(o=[N(n,"change",t[15]),N(n,"change",t[11])],i=!0)},p(s,a){a[0]&1&&l!==(l="use-toggle-checkbox "+(s[0]?"use-toggle-checkbox-enabled":""))&&E(n,"part",l),a[0]&1&&(n.checked=s[0])},d(s){s&&T(e),i=!1,R(o)}}}function ue(t){let e,n,l,r,i,o,s,a,f,v,d=[],g=new Map,y,h,O,w=t[3];const A=u=>u[28];for(let u=0;u<w.length;u+=1){let p=se(t,w,u),S=A(p);g.set(S,d[u]=_e(S,p))}return{c(){e=m("div"),n=m("select"),l=m("option"),l.textContent="Show",r=m("option"),r.textContent="Hide",i=F(`
			this field if
			`),o=m("select"),s=m("option"),s.textContent="all",a=m("option"),a.textContent="any",f=F(`
			of the following match:`),v=V();for(let u=0;u<d.length;u+=1)d[u].c();y=pe(),l.__value="show",l.value=l.__value,r.__value="hide",r.value=r.__value,E(n,"part","header-behavior-select"),t[1]===void 0&&q(()=>t[16].call(n)),s.__value="and",s.value=s.__value,a.__value="or",a.value=a.__value,E(o,"part","header-logic-select"),t[2]===void 0&&q(()=>t[17].call(o)),E(e,"class","conditional-logic-repeater__item"),E(e,"part","header")},m(u,p){j(u,e,p),_(e,n),_(n,l),_(n,r),J(n,t[1]),_(e,i),_(e,o),_(o,s),_(o,a),J(o,t[2]),_(e,f),j(u,v,p);for(let S=0;S<d.length;S+=1)d[S].m(u,p);j(u,y,p),h||(O=[N(n,"change",t[16]),N(n,"change",t[10]),N(o,"change",t[17]),N(o,"change",t[10])],h=!0)},p(u,p){p[0]&2&&J(n,u[1]),p[0]&4&&J(o,u[2]),p[0]&1944&&(w=u[3],d=ve(d,p,A,1,u,w,g,y.parentNode,be,_e,y,se))},d(u){u&&T(e),u&&T(v);for(let p=0;p<d.length;p+=1)d[p].d(u);u&&T(y),h=!1,R(O)}}}function fe(t){let e=[],n=new Map,l,r=t[7];const i=o=>o[31];for(let o=0;o<r.length;o+=1){let s=ae(t,r,o),a=i(s);n.set(a,e[o]=de(a,s))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();l=pe()},m(o,s){for(let a=0;a<e.length;a+=1)e[a].m(o,s);j(o,l,s)},p(o,s){s[0]&128&&(r=o[7],e=ve(e,s,i,1,o,r,n,l.parentNode,be,de,l,ae))},d(o){for(let s=0;s<e.length;s+=1)e[s].d(o);o&&T(l)}}}function de(t,e){let n,l=e[29].label+"",r;return{key:t,first:null,c(){n=m("option"),r=F(l),n.__value=e[29].value,n.value=n.__value,this.first=n},m(i,o){j(i,n,o),_(n,r)},p(i,o){e=i},d(i){i&&T(n)}}}function he(t){let e,n,l;function r(){return t[21](t[28])}return{c(){e=m("button"),e.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 10H19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>',E(e,"part","remove-condition-button")},m(i,o){j(i,e,o),n||(l=N(e,"click",r),n=!0)},p(i,o){t=i},d(i){i&&T(e),n=!1,l()}}}function _e(t,e){var D;let n,l,r,i,o,s,a,f,v,d,g,y,h,O,w,A,u,p,S,C=((D=e[4])==null?void 0:D.length)>0&&fe(e);function b(){e[18].call(l,e[27],e[28])}function M(){e[19].call(i,e[27],e[28])}function L(){e[20].call(h,e[27],e[28])}let k=e[28]>0&&he(e);return{key:t,first:null,c(){n=m("div"),l=m("select"),C&&C.c(),r=V(),i=m("select"),o=m("option"),o.textContent="is",s=m("option"),s.textContent="is not",a=m("option"),a.textContent="greater than",f=m("option"),f.textContent="less than",v=m("option"),v.textContent="contains",d=m("option"),d.textContent="starts with",g=m("option"),g.textContent="ends with",y=V(),h=m("input"),O=V(),w=m("button"),w.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 10H10M19 10H10M10 10V1M10 10V19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>',A=V(),k&&k.c(),u=V(),E(l,"part","item-field-select"),e[26].field===void 0&&q(b),o.__value="is",o.value=o.__value,s.__value="isnot",s.value=s.__value,a.__value="gt",a.value=a.__value,f.__value="lt",f.value=f.__value,v.__value="contains",v.value=v.__value,d.__value="startsWith",d.value=d.__value,g.__value="endsWith",g.value=g.__value,E(i,"part","item-comparison-select"),e[26].comparison===void 0&&q(M),E(h,"type","text"),E(h,"part","item-value-input"),E(w,"part","add-condition-button"),E(n,"class","conditional-logic-repeater__item"),E(n,"part","item"),this.first=n},m(B,z){j(B,n,z),_(n,l),C&&C.m(l,null),J(l,e[26].field),_(n,r),_(n,i),_(i,o),_(i,s),_(i,a),_(i,f),_(i,v),_(i,d),_(i,g),J(i,e[26].comparison),_(n,y),_(n,h),re(h,e[26].value),_(n,O),_(n,w),_(n,A),k&&k.m(n,null),_(n,u),p||(S=[N(l,"change",b),N(l,"change",e[10]),N(i,"change",M),N(i,"change",e[10]),N(h,"input",L),N(h,"change",e[10]),N(w,"click",e[8])],p=!0)},p(B,z){var I;e=B,((I=e[4])==null?void 0:I.length)>0?C?C.p(e,z):(C=fe(e),C.c(),C.m(l,null)):C&&(C.d(1),C=null),z[0]&136&&J(l,e[26].field),z[0]&136&&J(i,e[26].comparison),z[0]&136&&h.value!==e[26].value&&re(h,e[26].value),e[28]>0?k?k.p(e,z):(k=he(e),k.c(),k.m(n,u)):k&&(k.d(1),k=null)},d(B){B&&T(n),C&&C.d(),k&&k.d(),p=!1,R(S)}}}function Je(t){let e,n,l=t[6]&&ze(t),r=(t[0]||!t[6])&&ue(t);return{c(){e=m("div"),l&&l.c(),n=V(),r&&r.c(),this.c=W,E(e,"class","conditional-logic-repeater"),E(e,"part","container")},m(i,o){j(i,e,o),l&&l.m(e,null),_(e,n),r&&r.m(e,null),t[22](e)},p(i,o){i[6]&&l.p(i,o),i[0]||!i[6]?r?r.p(i,o):(r=ue(i),r.c(),r.m(e,null)):r&&(r.d(1),r=null)},i:W,o:W,d(i){i&&T(e),l&&l.d(),r&&r.d(),t[22](null)}}}function Re(t,e,n){var I,te,ne,oe,le;let{enabled:l=!0}=e,{behavior:r="show"}=e,{logic:i="and"}=e,{conditions:o=[{field:"",comparison:"is",value:""}]}=e,{fields:s}=e,{toggleable:a=null}=e,{value:f=null}=e,{autoclear:v=null}=e;const d={enabled:!0,behavior:"show",logic:"and",conditions:[{field:"",comparison:"is",value:""}]};let g;const y=typeof a<"u"&&a!==null,h=y&&typeof v<"u"&&v!==null,O=c=>{try{JSON.parse(c)}catch{return!1}return!0},w=(s==null?void 0:s.length)>0&&O(s)?JSON.parse(s):"",A=()=>{n(3,o=[...o,{field:"",comparison:"is",value:""}])},u=c=>{n(3,o=o.filter((P,ke)=>ke!==c)),p()},p=()=>{const c={detail:{enabled:l,behavior:r,logic:i,conditions:o},composed:!0};g.dispatchEvent(new CustomEvent("es-conditional-logic-repeater-update",c))},S=()=>{p(),h&&!l&&(n(3,o=d.conditions),n(1,r=d.behavior),n(2,i=d.logic))};if(typeof f<"u"&&f!==null&&O(f)){const c=JSON.parse(f);!Array.isArray(c)&&((I=Object.keys(c))==null?void 0:I.length)>=1&&(l=(te=c==null?void 0:c.enabled)!=null?te:d.enabled,r=(ne=c==null?void 0:c.behavior)!=null?ne:d.behavior,i=(oe=c==null?void 0:c.logic)!=null?oe:d.logic,o=(le=c==null?void 0:c.conditions)!=null?le:d.conditions)}function C(){l=this.checked,n(0,l)}function b(){r=G(this),n(1,r)}function M(){i=G(this),n(2,i)}function L(c,P){c[P].field=G(this),n(3,o),n(7,w)}function k(c,P){c[P].comparison=G(this),n(3,o),n(7,w)}function D(c,P){c[P].value=this.value,n(3,o),n(7,w)}const B=c=>u(c);function z(c){Z[c?"unshift":"push"](()=>{g=c,n(5,g)})}return t.$$set=c=>{"enabled"in c&&n(0,l=c.enabled),"behavior"in c&&n(1,r=c.behavior),"logic"in c&&n(2,i=c.logic),"conditions"in c&&n(3,o=c.conditions),"fields"in c&&n(4,s=c.fields),"toggleable"in c&&n(12,a=c.toggleable),"value"in c&&n(13,f=c.value),"autoclear"in c&&n(14,v=c.autoclear)},[l,r,i,o,s,g,y,w,A,u,p,S,a,f,v,C,b,M,L,k,D,B,z]}class Be extends ye{constructor(e){super(),this.shadowRoot.innerHTML='<style>.conditional-logic-repeater{--rptr-font-family:system-ui, sans-serif;--rptr-accent-color:var(--es-conditional-logic-repeater-accent, #29a3a3);--rptr-input-border-color:var(--es-conditional-logic-repeater-input-border, #8f9c9c);--rptr-font-size:var(--es-conditional-logic-repeater-font-size, 0.9em);font-family:system-ui, sans-serif;font-size:var(--rptr-font-size);display:flex;flex-direction:column;gap:1rem}.conditional-logic-repeater,.conditional-logic-repeater *{box-sizing:border-box}button{padding:0.25rem;border:0;margin:0;width:1.75rem;height:1.75rem;background-color:transparent;color:var(--rptr-accent-color);border:1px solid var(--rptr-accent-color);border-radius:100rem;display:flex;align-items:center;justify-content:center;cursor:pointer}button svg{width:1rem;height:1rem}input[type="checkbox"]{width:1.25rem;height:1.25rem;accent-color:var(--rptr-accent-color)}input[type="text"],select{height:2.5rem;border-radius:0.25rem;border:1px solid var(--rptr-input-border-color);padding:0.5rem;outline-color:var(--es-conditional-logic-repeater-accent);accent-color:var(--es-conditional-logic-repeater-accent)}label,.conditional-logic-repeater__item{display:flex;align-items:center;line-height:1}label{gap:0.25rem}.conditional-logic-repeater__item{gap:0.75rem}</style>',Te(this,{target:this.shadowRoot,props:Me(this.attributes),customElement:!0},Re,Je,we,{enabled:0,behavior:1,logic:2,conditions:3,fields:4,toggleable:12,value:13,autoclear:14},null,[-1,-1]),e&&(e.target&&j(e.target,this,e.anchor),e.props&&(this.$set(e.props),H()))}static get observedAttributes(){return["enabled","behavior","logic","conditions","fields","toggleable","value","autoclear"]}get enabled(){return this.$$.ctx[0]}set enabled(e){this.$$set({enabled:e}),H()}get behavior(){return this.$$.ctx[1]}set behavior(e){this.$$set({behavior:e}),H()}get logic(){return this.$$.ctx[2]}set logic(e){this.$$set({logic:e}),H()}get conditions(){return this.$$.ctx[3]}set conditions(e){this.$$set({conditions:e}),H()}get fields(){return this.$$.ctx[4]}set fields(e){this.$$set({fields:e}),H()}get toggleable(){return this.$$.ctx[12]}set toggleable(e){this.$$set({toggleable:e}),H()}get value(){return this.$$.ctx[13]}set value(e){this.$$set({value:e}),H()}get autoclear(){return this.$$.ctx[14]}set autoclear(e){this.$$set({autoclear:e}),H()}}customElements.define("conditional-logic-repeater",Be);
}
